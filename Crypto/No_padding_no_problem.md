# No padding no problem
Người giải: Temma
Thể loại: mật mã
Trang bài: https://play.picoctf.org/practice/challenge/154?category=2&difficulty=2&page=2

## Đề bài
Oracles can be your best friend, they will decrypt anything, except the flag's ciphertext. How will you break it?

## Giải pháp

Kết nối bằng câu lệnh, ta được:
```
(base) temma@DESKTOP-IE5BPNN:~$ nc mercury.picoctf.net 30048
Welcome to the Padding Oracle Challenge
This oracle will take anything you give it and decrypt using RSA. It will not accept the ciphertext with the secret message... Good Luck!


n: 51257263015582188197648371474129549390905726426257438448153816359702362365658508334422660676137191608574589301862860723036048910648313371474365316649888203989162930646519011433136231329260451213231902920703710354241532734042339059649207865410951756937740333312020743615116676965217774179610963694893894058993
e: 65537
ciphertext: 4630900525813217788908324506108030714601444705261980401094718094759603138876572869225585464832937171107712654868912146981974620187638194979958086597403998901460677636640013168017847942623819676132193036153903064536382635689292213133256195449181769142311263486211152780709880862212814932262615707105931438936


Give me ciphertext to decrypt: 
```
Ta sẽ được giải mã nhưng lại không được đưa ciphertext vào??
```
Give me ciphertext to decrypt: 4630900525813217788908324506108030714601444705261980401094718094759603138876572869225585464832937171107712654868912146981974620187638194979958086597403998901460677636640013168017847942623819676132193036153903064536382635689292213133256195449181769142311263486211152780709880862212814932262615707105931438936
Will not decrypt the ciphertext. Try Again
```
Thế phải hơi lách luật bằng cách đưa vào giá trị khác nhưng lại đẳng cấu( hiểu nôm na là tuyến tính với ciphertext ban đầu)
```
encrypt(m1) * encrypt(m2) = m1**e * m2**e = (m1*m2)**e = encrypt(m1*m2)
```
Vậy nên ta chỉ cần gửi một giá trị đã biết: Ví dụ 2
```
>>> n = 51257263015582188197648371474129549390905726426257438448153816359702362365658508334422660676137191608574589301862860723036048910648313371474365316649888203989162930646519011433136231329260451213231902920703710354241532734042339059649207865410951756937740333312020743615116676965217774179610963694893894058993
>>> e = 65537
>>> c = 4630900525813217788908324506108030714601444705261980401094718094759603138876572869225585464832937171107712654868912146981974620187638194979958086597403998901460677636640013168017847942623819676132193036153903064536382635689292213133256195449181769142311263486211152780709880862212814932262615707105931438936
>>> x = pow(2, e, n)
```
Lúc này chỉ cần tính c*x và rồi gửi lên thì ta sẽ nhận được m*2
```
>>> c * x
100143595101097482592830943996394084935896483190946501375900036789656563468161771661159361446264540870562875321563459868013559419801317017795671701911596839916318680717002043340397523992749301372798696850257395023843247887528117688037460937112899173181293401186268292785004213926734919791665692392466430105479585506366934056729120410715233430015617324382399879565964709375420317296313695324694080441459057761080942252174906527624295046338332389255727665817282665574808829804572524114287684014904494989016474124730841293049413485569031168274716135702636601427701120705065779700896004485699711505643761704463675796224
```
```
Give me ciphertext to decrypt: 100143595101097482592830943996394084935896483190946501375900036789656563468161771661159361446264540870562875321563459868013559419801317017795671701911596839916318680717002043340397523992749301372798696850257395023843247887528117688037460937112899173181293401186268292785004213926734919791665692392466430105479585506366934056729120410715233430015617324382399879565964709375420317296313695324694080441459057761080942252174906527624295046338332389255727665817282665574808829804572524114287684014904494989016474124730841293049413485569031168274716135702636601427701120705065779700896004485699711505643761704463675796224
Here you go: 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890769425795379846471930
```
Ta chia lại (m*2) cho 2 và chuyển thành dạng byte(hoặc string nếu muốn copy paste cho lẹ !)
Ở đây nếu ai chưa có thư viện pycryptodome thì dùng lệnh sau
```
>>> bytearray.fromhex(format(m, 'x')).decode()
```
Không thì có thể sài long_to_bytes(long_num)
Đây là đoạn script tham khảo (tham khảo thôi nha!!)
```
#!/usr/bin/python3

from Crypto.Util.number import *
from pwn import *

p = remote('mercury.picoctf.net',30048)

p.recvuntil(b'n:')
n = int(p.recvline().decode())
p.recvuntil(b'e:')
e = int(p.recvline().decode())
p.recvuntil(b'ciphertext:')
c = int(p.recvline().decode())
print(f'n = {n}')
print(f'e = {e}')
print(f'c = {c}')

tg = pow(2,e,n)

p.sendlineafter(b'decrypt:',str(pow(c*tg,1,n)).encode())

p.recvuntil(b'go:')

cx2 = int(p.recvline().decode())

print((c*2) < n)

print(f'cx2 = {cx2}')

m = cx2//2

print(long_to_bytes(m).decode())
```
Và ta đã có cờ: picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_5052620}



